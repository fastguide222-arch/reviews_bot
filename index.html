from aiogram import Bot, Dispatcher, types
from aiogram.utils import executor

TOKEN = "8496471458:AAG-O5Eli7krQx9FKHmpr5jyLnCV5AvP3c0"

bot = Bot(token=TOKEN)
dp = Dispatcher(bot)

# Список каналов с айди
CHANNELS = {
    "Канал 1": -1002526285031,
    "Канал 2": -1002716220445,
    "Канал 3": -1002651825180,
    "Канал 4": -1002770818048,
    "Канал 5": -1002622247826,
}

# Временное хранилище оценок и отзывов
user_data = {}

# Начало
@dp.message_handler(commands=['start'])
async def start(message: types.Message):
    await message.reply("Привет! Выбери канал для отзыва:\n" + "\n".join(CHANNELS.keys()))
    user_data[message.from_user.id] = {}

# Выбор канала
@dp.message_handler(lambda message: message.text in CHANNELS)
async def choose_channel(message: types.Message):
    user_data[message.from_user.id]["channel"] = message.text
    await message.reply(f"Вы выбрали канал: {message.text}\nСколько звезд ставите? (1-5)")

# Выбор оценки
@dp.message_handler(lambda message: message.text.isdigit() and 1 <= int(message.text) <= 5)
async def choose_rating(message: types.Message):
    user_data[message.from_user.id]["rating"] = int(message.text)
    await message.reply("Напиши отзыв (не менее 70 символов):\n**Отзыв для канала " + user_data[message.from_user.id]["channel"] + "**")

# Получение отзыва
@dp.message_handler(lambda message: len(message.text) >= 70)
async def get_review(message: types.Message):
    uid = message.from_user.id
    channel_name = user_data[uid]["channel"]
    rating = user_data[uid]["rating"]
    
    if rating >= 4:  # Только оценки 4 и 5 отправляем в канал
        text = f"**Отзыв для канала {channel_name}**\nОценка: {rating}\n{message.text}"
        await bot.send_message(chat_id=CHANNELS[channel_name], text=text)
    
    await message.reply("Спасибо за отзыв!")
    user_data.pop(uid)

# Обработка слишком коротких отзывов
@dp.message_handler(lambda message: len(message.text) < 70)
async def too_short(message: types.Message):
    await message.reply("Отзыв слишком короткий, нужно хотя бы 70 символов.")

if __name__ == '__main__':
    executor.start_polling(dp, skip_updates=True)

